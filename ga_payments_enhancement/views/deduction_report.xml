<odoo>
    <template id="report_payment_deduction">
        <t t-foreach="docs" t-as="o">
            <t t-call="ga_payments_enhancement.subtemplate_layout_header">
                <div class="page">
                    <table style="max-width:100%; width:100%;">
                        <tr>
                            <td>Party Name:
                                <span style="padding-left:15px;">
                                    <t t-esc="o.partner_id.name"/>
                                </span>
                            </td>
                            <td class="text-right">Date:
                                <span>
                                    <t t-esc="datetime.datetime.strptime(str(o.payment_date), '%Y-%m-%d').strftime('%d-%b-%y')"/>
                                </span>
                            </td>
                        </tr>
                        <tr>
                            <td>Party address:
                                <span>
                                    <t t-esc="o.partner_id.street"/>
                                    <t t-esc="o.partner_id.street2"/>
                                </span>
                            </td>
                        </tr>
                    </table>
                    <br/>
                    Dear Sir
                    <br/>
                    <br/>
                    <t t-esc="'Kindly find the cheque# {0} dated {1} against the payment of your below mentioned invoices.'.format(o.communication, datetime.datetime.strptime(str(o.payment_date), '%Y-%m-%d').strftime('%d-%b-%y'))"/>
                    <br/>
                    <br/>
                    <style>
                        .border_left_top_bottom {
                        border-left:1px solid black;
                        border-top:1px solid black;
                        border-bottom:1px solid black;
                        }
                        .border_top_bottom_right {
                        border-right:1px solid black;
                        border-top:1px solid black;
                        border-bottom:1px solid black;
                        }
                        .border_top_left_right {
                        border-right:1px solid black;
                        border-top:1px solid black;
                        border-left:1px solid black;
                        }
                    </style>
                    <t t-set="total_amount_paid" t-value="0"/>
                    <t t-set="total_receiving_amount" t-value="0"/>
                    <table style="max-width:100%; width:100%; border:1px solid black;">
                        <thead>
                            <tr style="background:#ccc">
                                <th style="padding:5px" class="border_left_top_bottom">Description
                                </th>
                                <th style="padding:5px" class="text-right border_top_bottom_right">Amount</th>
                            </tr>
                        </thead>
                    </table>
                    <br/>
                    <t t-set="i" t-value="0"/>
                    <t t-set="j" t-value="0"/>
                    <t t-set="k" t-value="0"/>
                    <t t-set="l" t-value="0"/>
                    <t t-foreach="o.deductions" t-as="deduction">
                        <table style="max-width:100%; width:100%; border:1px solid black;">
                            <tbody>
                                <tr style="background:#ddd;">
                                    <td style="padding:5px" class="border_left_top_bottom">
                                        <b>
                                            <t t-if="deduction.invoice_id.type=='in_invoice'">
                                                <span t-esc="deduction.invoice_id.reference"/>
                                            </t>
                                             <t t-if="deduction.invoice_id.type=='out_invoice'">
                                                <span t-field="deduction.invoice_id"/>
                                            </t>
                                            <span style="margin-left:5px !important;margin-right:5px !important;">-
                                            </span>
                                            <i>
                                                <span t-esc="deduction.invoice_id.date_invoice"/>
                                            </i>
                                        </b>
                                    </td>
                                    <td class="text-right border_right_top_bottom" style="padding:5px">

                                        <span t-esc="'{:,.2f}'.format(deduction.balance_amt)"/>
                                        <t t-set="i" t-value="i+deduction.balance_amt"/>

                                    </td>
                                </tr>
                                <tr>
                                    <td style="padding:5px" class="border_left_top_bottom">
                                        <b>
                                            Invoice Paid Amount
                                        </b>
                                    </td>
                                    <td class="text-right border_top_bottom_right" style="padding:5px">

                                        <span t-esc="'{:,.2f}'.format(deduction.receiving_amt+deduction.writeoff_account_id_.total_writeoff_amount)"/>
                                        <t t-set="j"
                                           t-value="j+(deduction.receiving_amt+deduction.writeoff_account_id_.total_writeoff_amount)"/>

                                    </td>
                                </tr>
                                <t t-if="len(deduction.writeoff_account_id_.writeoff_line)>0">
                                    <tr>
                                        <td colspan="2" style="padding:5px" class="border_top_left_right">
                                            <b>
                                                <span style="margin-left:5px;">Deductions</span>
                                            </b>
                                        </td>
                                    </tr>
                                    <t t-foreach="deduction.writeoff_account_id_" t-as="writeoffs">
                                        <t t-foreach="writeoffs.writeoff_line" t-as="counterpart">
                                            <tr>
                                                <td style="padding:5px">
                                                    <span t-esc="counterpart.description" style="margin-left:10px;"/>
                                                </td>
                                                <td style="padding:5px" class="text-right">
                                                    <span t-esc="'{:,.2f}'.format(counterpart.amount_payment)"/>
                                                    <t t-set="l" t-value="l+counterpart.amount_payment"/>
                                                </td>
                                            </tr>
                                        </t>
                                    </t>
                                </t>

                                <tr>
                                    <td style="padding:5px" class="border_left_top_bottom">
                                        <i>
                                            <b>Payment
                                                Amount
                                            </b>
                                        </i>
                                    </td>
                                    <td style="padding:5px" class="text-right border_top_bottom_right">
                                        <i>
                                            <b>
                                                <span t-esc="'{:,.2f}'.format(deduction.receiving_amt)"/>
                                                <t t-set="k" t-value="k+deduction.receiving_amt"/>
                                            </b>
                                        </i>
                                    </td>

                                </tr>


                            </tbody>
                        </table>

                        <br/>
                    </t>
                    <table style="max-width:100%; width:100%;">
                        <thead>
                            <tr>
                                <th style="padding:5px">Total Cheque Amount
                                </th>
                                <th style="padding:5px" class="text-right">
                                    <span t-field="o.amount"/>
                                </th>
                            </tr>
                        </thead>
                    </table>
                    <br/>

                    <table style="max-width:100%; width:100%; border:1px solid black;">
                        <tbody>

                            <tr style="background:#ddd;">
                                <td style="padding:5px" class="border_left_top_bottom">
                                    <b>
                                        <span>Summary</span>
                                        <span style="margin-left:5px !important;margin-right:5px !important;">-
                                        </span>
                                        <i>
                                            <span>Total</span>
                                        </i>
                                    </b>
                                </td>
                                <td class="text-right border_right_top_bottom" style="padding:5px">
                                </td>
                            </tr>
                            <tr>
                                <td style="padding:5px" class="border_left_top_bottom">
                                    <b>
                                        Invoice Amount
                                    </b>
                                </td>
                                <td class="text-right border_top_bottom_right" style="padding:5px">

                                    <span t-esc="'{:,.2f}'.format(i)"/>

                                </td>
                            </tr>

                            <tr>
                                <td style="padding:5px" class="border_left_top_bottom">
                                    <b>Invoice Paid
                                        Amount
                                    </b>
                                </td>
                                <td style="padding:5px" class="text-right border_top_bottom_right">
                                    <span t-esc="'{:,.2f}'.format(j)"/>
                                </td>

                            </tr>
                            <tr>
                                <td style="padding:5px" class="border_left_top_bottom">
                                    <i>
                                        <b>Deductions
                                        </b>
                                    </i>
                                </td>
                                <td style="padding:5px" class="text-right border_top_bottom_right">
                                    <i>

                                        <span t-esc="'{:,.2f}'.format(l)"/>

                                    </i>
                                </td>
                            </tr>
                            <tr>
                                <td style="padding:5px" class="border_left_top_bottom">
                                    <b>Payment
                                        Amount
                                    </b>
                                </td>
                                <td style="padding:5px" class="text-right border_top_bottom_right">
                                    <span t-esc="'{:,.2f}'.format(k)"/>
                                </td>

                            </tr>

                        </tbody>
                    </table>

                    <br/>
                    <br/>
                    Please acknowledge receipt.
                    <br/>
                    <br/>
                    Yours faithfully,
                    <br/>
                    <br/>
                    <br/>
                    Finance Department.
                </div>
            </t>
        </t>
    </template>
</odoo>